#!/bin/bash

if ! command -v mpg123 >/dev/null; then
  echo ""
  echo "âš ï¸  'mpg123' is required to play the anthem."
  echo "   It seems to be missing from your system."
  echo ""
  echo "ðŸ›   Install it using Homebrew:"
  echo "   brew install mpg123"
  echo ""
  exit 1
fi

if [[ -f "${HOMEBREW_PREFIX}/share/kimigayo/mp3/kimigayo.mp3" ]]; then
  MP3_PATH="${HOMEBREW_PREFIX}/share/kimigayo/mp3/kimigayo.mp3"
else
  MP3_PATH="$(dirname "$0")/../mp3/kimigayo.mp3"
fi

# set FLAG_MODE
FLAG_MODE=true
[ "$1" = "--no-flag" ] && FLAG_MODE=false

if [ "$FLAG_MODE" = true ]; then
  FLAG="ðŸ‡¯ðŸ‡µ"
  FLAG_LINE="â”€â”€"
  FLAG_SPACE="  "
else
  FLAG=""
  FLAG_LINE=""
  FLAG_SPACE=""
fi

LYRICS="
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"$FLAG_LINE"â”€â”€â”€â”
  â”‚    è‹”  å·Œ  ã•  åƒ  å›  $FLAG   â”‚
  â”‚    ã®  ã¨  ã–  ä»£  ãŒ  "$FLAG_SPACE"   â”‚
  â”‚    ã‚€  ãª  ã‚Œ  ã«  ä»£  "$FLAG_SPACE"   â”‚
  â”‚    ã™  ã‚Š  çŸ³  å…«  ã¯  "$FLAG_SPACE"   â”‚
  â”‚    ã¾  ã¦  ã®  åƒ      "$FLAG_SPACE"   â”‚
  â”‚    ã§          ä»£      "$FLAG_SPACE"   â”‚
  â”‚                ã«      "$FLAG_SPACE"   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"$FLAG_LINE"â”€â”€â”€â”˜
"

# Clear screen and hide cursor
clear
tput civis

# Display the lyrics (vertical-style layout)
echo -e "$LYRICS"

# Play the anthem (suppress all mpg123 output)
mpg123 "$MP3_PATH" >/dev/null 2>&1

# Clear screen and restore cursor
clear
tput cnorm
